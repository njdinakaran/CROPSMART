<html>
    <head>
        <title>
            CropSmart - Home page
        </title>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="css/indexstyle.css">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">

    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,200;1,500&family=Roboto:ital,wght@0,300;1,300;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    </head>

    <body>
        <header>
            <a href="#" class="logo">CropSmart</a>
        
            <ul class="navlist">
                <li><a href="#" class="home" onclick="movecrop()">Crop Recommendation</a></li>
                <li><a href="#" class="home" onclick="movepest()">Pest Identification</a></li>
                <li><a href="#" class="home" onclick="moveweed()">Weed Identification</a></li>
                <li><a href="#" class="leave" onclick="logout()">About</a></li>
            </ul>
        
            <div class="bx bx-menu" id="menu-icon"></div>
          </header>

          <div class="content">
            <div class="left">
                <h2>crop Section</h2>
                <p>To display images of crops and details</p>
            </div>
            <div class="right">
                <h2>weather Section</h2>
                <p>display weather details</p>
                <p id="city"></p>
                <p id="weather"></p>
                <p id="forecast"></p>

            </div>
        </div>

    </body>

    <script>
        function showPosition(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            fetchCityName(latitude, longitude);
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    promptForCity();
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("Location information is unavailable.");
                    promptForCity();
                    break;
                case error.TIMEOUT:
                    alert("The request to get user location timed out.");
                    promptForCity();
                    break;
                case error.UNKNOWN_ERROR:
                    alert("An unknown error occurred.");
                    promptForCity();
                    break;
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                alert("Geolocation is not supported by this browser.");
                promptForCity();
            }
        }


        function promptForCity() {
    const city = prompt("Please enter your city:", "");
    if (city) {
        fetchWeather(city); // Trim whitespace from the input
    }
}

// function fetchCitySuggestions(city) {
//     const username = 'warrior14032125'; // Replace with your GeoNames username
//     const url = `https://secure.geonames.org/searchJSON?q=${encodeURIComponent(city)}&country=IN&maxRows=10&username=${username}`;

//     fetch(url)
//         .then(response => {
//             if (!response.ok) {
//                 throw new Error('Network response was not ok');
//             }
//             return response.json();
//         })
//         .then(data => {
//             if (data && data.geonames && data.geonames.length > 0) {
//                 const suggestedCity = data.geonames[0].name;
//                 document.getElementById('city').innerText = "City: " + suggestedCity;
//                 fetchWeather(suggestedCity);
//             } else {
//                 alert("City not found. Please enter a valid Indian city name.");
//                 promptForCity();
//             }
//         })
//         .catch(error => {
//             console.error('Error fetching city suggestions:', error);
//             alert("An error occurred while fetching city suggestions. Please try again.");
//             promptForCity();
//         });
// }





//fetch location based on current location

        function fetchCityName(latitude, longitude) {
            const apiKey = 'bdc_7ef6213578c94844915f32a5cc46c020'; // Replace with your actual API key
            const url = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const city = data.city || data.locality;
                    document.getElementById('city').innerText = "City: " + city;
                    fetchWeather(city);
                    // Use the fetched city to get weather data or other information
                })
                .catch(error => {
                    console.error('Error fetching city name:', error);
                    promptForCity();
                });
        }

        //fetch weather details
        function fetchWeather(city) {
            const apiKey = 'c31f6a98e766fa63e3fedbbf0fed011d'; // Replace with your OpenWeatherMap API key
            const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${apiKey}`;
            const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&appid=${apiKey}`;

            fetch(weatherUrl)
                .then(response => response.json())
                .then(data => {
                    const weather = `Current Weather: ${data.weather[0].description}, Temperature: ${data.main.temp}°C`;
                    document.getElementById('weather').innerText = weather;
                })
                .catch(error => {
                    console.error('Error fetching weather data:', error);
                });

            fetch(forecastUrl)
                .then(response => response.json())
                .then(data => {
                    let forecast = '4-Day Forecast:';
                    for (let i = 0; i < data.list.length; i += 8) { // 8 intervals per day
                        const date = new Date(data.list[i].dt_txt).toDateString();
                        const temp = data.list[i].main.temp;
                        const desc = data.list[i].weather[0].description;
                        forecast += `<br>${date}: ${desc}, Temperature: ${temp}°C`;
                    }
                    document.getElementById('forecast').innerHTML = forecast;
                })
                .catch(error => {
                    console.error('Error fetching forecast data:', error);
                });
        }

        window.onload = getLocation;



        // page movement functions

        function movecrop(){
    window.location.href = `crop_predict.html`;
        }
        function movepest(){
    window.location.href = `pest_predict.html`;
        }
        function moveweed(){
    window.location.href = `weed_predict.html`;
        }
    </script>
</html>